<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Lyckohjulet 1984 - NES Edition (Svenska)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Retro Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --nes-black: #000000;
        --nes-white: #ffffff;
        --nes-red: #e70000;
        --nes-green: #00b500;
        --nes-blue: #0000eb; /* NES Classic Blue background */
        --nes-yellow: #fbbc04;
        --board-green: #006600;
        --board-border: #fbbc04;
      }

      body {
        background-color: var(--nes-blue);
        color: var(--nes-white);
        font-family: "Press Start 2P", cursive;
        overflow-x: hidden;
        overflow-y: auto; /* Tillåt scroll */
        touch-action: manipulation;
        user-select: none;
        margin: 0;
        padding: 0;
        height: 100vh; /* Sätt höjd till viewport */
        display: flex;
        flex-direction: column;
      }

      /* --- SCANLINES & CRT EFFECT --- */
      .scanlines {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            rgba(18, 16, 16, 0) 50%,
            rgba(0, 0, 0, 0.25) 50%
          ),
          linear-gradient(
            90deg,
            rgba(255, 0, 0, 0.06),
            rgba(0, 255, 0, 0.02),
            rgba(0, 0, 255, 0.06)
          );
        background-size: 100% 2px, 3px 100%;
        pointer-events: none;
        z-index: 999;
      }

      /* --- SCREENS --- */
      .screen {
        width: 100%;
        min-height: 100%; /* Fyll minst skärmen */
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
      }
      .screen.active {
        display: flex;
      }

      /* --- START SCREEN --- */
      #start-screen {
        background-color: #000;
        z-index: 50;
        justify-content: center;
        position: fixed; /* Täck allt */
        top: 0;
        left: 0;
        height: 100%;
      }
      .logo-title {
        font-size: clamp(24px, 5vw, 60px);
        color: var(--nes-yellow);
        text-shadow: 4px 4px var(--nes-red), 8px 8px #000;
        margin-bottom: 40px;
        line-height: 1.2;
        text-align: center;
      }
      .menu-option {
        margin: 10px;
        color: #888;
        cursor: pointer;
        font-size: clamp(12px, 2.5vw, 18px);
      }
      .menu-option.selected {
        color: var(--nes-white);
      }
      .menu-option.selected::before {
        content: "►";
        margin-right: 10px;
        color: var(--nes-red);
      }

      /* --- GAME UI --- */
      #game-screen {
        background-color: var(--nes-blue);
        padding-top: 5px;
        padding-bottom: 0;
      }

      /* Player HUD (Top) */
      .player-hud {
        display: flex;
        width: 100%;
        max-width: 800px;
        justify-content: space-evenly;
        margin-bottom: 5px; /* Mindre marginal */
        background: #000;
        border: 2px solid #fff;
        padding: 5px;
        min-height: 70px; /* Lite kompaktare */
        align-items: flex-start;
        flex-shrink: 0;
      }
      .player-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 30%;
      }
      .avatar-container {
        width: 25px;
        height: 25px;
        margin-bottom: 2px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .avatar {
        width: 2px;
        height: 2px;
        background: transparent;
        box-shadow: 5px 0 0 0 #ccc, 10px 0 0 0 #ccc, 15px 0 0 0 #ccc,
          20px 0 0 0 #ccc, 25px 0 0 0 #ccc, 5px 5px 0 0 #ccc, 25px 5px 0 0 #ccc,
          5px 10px 0 0 #ccc, 10px 10px 0 0 #000, 20px 10px 0 0 #000,
          25px 10px 0 0 #ccc, 5px 15px 0 0 #ccc, 25px 15px 0 0 #ccc,
          5px 20px 0 0 #ccc, 10px 20px 0 0 #000, 15px 20px 0 0 #000,
          20px 20px 0 0 #000, 25px 20px 0 0 #ccc, 10px 25px 0 0 #ccc,
          15px 25px 0 0 #ccc, 20px 25px 0 0 #ccc;
        position: relative;
        left: -12px;
        top: -10px;
      }
      .player-name {
        font-size: 8px;
        color: var(--nes-red);
        margin-bottom: 2px;
        text-transform: uppercase;
        text-align: center;
      }
      .player-score {
        font-size: 10px;
        color: var(--nes-white);
        text-align: center;
      }

      /* Board - FÖRSTORAD */
      .board-frame {
        background-color: var(--board-green);
        border: 4px solid var(--board-border);
        padding: 4px;
        display: grid;
        grid-template-rows: repeat(4, 1fr);
        gap: 2px;
        width: 98%;
        max-width: 800px; /* Tillåt bredare bräde */
        aspect-ratio: auto;
        min-height: 180px; /* ÖKAD HÖJD (Var 120px) */
        flex-shrink: 0; /* Förhindra att den krymper för mycket */
        box-shadow: 3px 3px 0px rgba(0, 0, 0, 0.5);
        margin-bottom: 10px;
      }
      /* ÖKAD RADHÖJD */
      .board-row {
        display: grid;
        grid-template-columns: repeat(14, 1fr);
        gap: 1px;
        height: 38px;
      } /* Var 25px */

      @media (min-width: 600px) {
        .board-row {
          height: 55px;
          gap: 3px;
        } /* Ännu större på desktop */
        .board-frame {
          padding: 10px;
          border-width: 6px;
          margin-bottom: 15px;
          min-height: 250px;
        }
      }

      .board-cell {
        background-color: var(--board-green);
        display: flex;
        align-items: center;
        justify-content: center;
        /* ÖKAD FONTSTORLEK */
        font-size: clamp(12px, 3.5vw, 28px); /* Var 8-20px */
        color: black;
        position: relative;
      }
      .board-cell.active {
        background-color: var(--nes-white);
        box-shadow: inset 1px 1px #fff, inset -1px -1px #888;
      }
      .letter-content {
        opacity: 0;
        color: #000;
      }
      .letter-content.visible {
        opacity: 1;
      }

      /* Category Box */
      .category-box {
        background: #000;
        border: 2px solid var(--nes-white);
        color: var(--nes-white);
        padding: 3px 10px;
        margin: 2px 0;
        font-size: 9px;
        text-transform: uppercase;
        flex-shrink: 0;
      }

      /* Message Area */
      #msg-area {
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        margin: 2px 0;
        flex-shrink: 0;
      }

      /* Keyboard / Controls */
      #controls-area {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #000;
        padding: 10px 5px 30px 5px; /* Extra padding i botten (30px) */
        border-top: 4px solid #fff;
        margin-top: auto; /* Tryck ner till botten */
        flex-shrink: 0;
      }
      .key {
        background-color: var(--nes-blue);
        border: 2px solid var(--nes-white);
        color: var(--nes-white);
        width: clamp(26px, 8.5vw, 40px); /* Något bredare för att fylla ut */
        height: clamp(32px, 9.5vw, 45px); /* Något högre */
        margin: 2px;
        font-size: clamp(10px, 3.5vw, 16px);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
      .key:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        border-color: #555;
      }
      .key.vowel {
        background-color: var(--nes-red);
      }

      .action-btn {
        padding: 8px 10px;
        background: var(--nes-red);
        color: white;
        border: 2px solid white;
        font-family: inherit;
        cursor: pointer;
        margin: 0 2px;
        text-transform: uppercase;
        font-size: 9px;
        min-width: 60px;
      }
      @media (min-width: 600px) {
        .action-btn {
          font-size: 12px;
          padding: 10px 20px;
          margin: 0 5px;
          border-width: 3px;
        }
      }
      .action-btn:hover {
        background: #ff4444;
      }
      .action-btn:disabled {
        background: #555;
        color: #888;
      }

      /* --- WHEEL OVERLAY --- */
      #wheel-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 60;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #wheel-overlay.active {
        display: flex;
      }

      #power-meter-container {
        width: 300px;
        height: 30px;
        border: 4px solid white;
        margin-top: 20px;
        background: #000;
        position: relative;
        display: none;
      }
      #power-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(to right, #0f0, #ff0, #f00);
        transition: width 0.05s linear;
      }

      .spin-msg {
        color: var(--nes-yellow);
        margin-bottom: 20px;
        font-size: 14px;
        text-align: center;
        line-height: 1.5;
      }

      #wheel-canvas {
        width: 300px;
        height: 300px;
        margin-bottom: 20px;
      }
      #arrow-pointer {
        position: absolute;
        top: 50%;
        right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="scanlines"></div>

    <!-- 1. START SCREEN -->
    <div id="start-screen" class="screen active">
      <div class="logo-title">LYCKO<br />HJULET</div>

      <div class="menu-option selected" onclick="startGame()">1 SPELARE</div>
      <div class="menu-option">2 SPELARE</div>
      <div class="menu-option">3 SPELARE</div>

      <div
        style="
          margin-top: 60px;
          font-size: 10px;
          color: #fff;
          text-align: center;
        "
      >
        © 1984 GAMETEK<br />ALLA RÄTTIGHETER FÖRBEHÅLLNA
      </div>
    </div>

    <!-- 2. GAME SCREEN -->
    <div id="game-screen" class="screen">
      <!-- Player HUD -->
      <div class="player-hud">
        <!-- Player 1 -->
        <div class="player-card">
          <div class="avatar-container">
            <div class="avatar"></div>
          </div>
          <div class="player-name">SPELARE 1</div>
          <div class="player-score" id="score-display">0000</div>
        </div>

        <!-- CPU Players (Visual) -->
        <div class="player-card" style="opacity: 0.6">
          <div class="avatar-container">
            <div class="avatar" style="filter: hue-rotate(90deg)"></div>
          </div>
          <div class="player-name">DATOR 2</div>
          <div class="player-score">0000</div>
        </div>

        <div class="player-card" style="opacity: 0.6">
          <div class="avatar-container">
            <div class="avatar" style="filter: hue-rotate(180deg)"></div>
          </div>
          <div class="player-name">DATOR 3</div>
          <div class="player-score">0000</div>
        </div>
      </div>

      <!-- Category -->
      <div class="category-box" id="category-display">KATEGORI</div>

      <!-- The Board -->
      <div class="board-frame" id="board-container">
        <!-- Grid generated by JS -->
      </div>

      <!-- Message Area -->
      <div id="msg-area">
        <p
          id="game-msg"
          style="
            color: var(--nes-yellow);
            font-size: 10px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
          "
        >
          TRYCK PÅ SNURRA FÖR ATT STARTA
        </p>
      </div>

      <!-- Controls -->
      <div id="controls-area">
        <div
          style="
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            width: 100%;
          "
        >
          <button
            id="btn-spin"
            class="action-btn"
            onclick="startSpinSequence()"
          >
            SNURRA
          </button>
          <button
            id="btn-buy"
            class="action-btn"
            disabled
            onclick="buyVowelMode()"
          >
            KÖP VOKAL ($250)
          </button>
          <button id="btn-solve" class="action-btn" onclick="solveMode()">
            LÖS
          </button>
        </div>
        <div
          id="keyboard"
          style="
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 600px;
          "
        >
          <!-- Keys generated -->
        </div>
      </div>
    </div>

    <!-- 3. WHEEL OVERLAY (Spinning Phase) -->
    <div id="wheel-overlay">
      <p id="spin-status-text" class="spin-msg">
        TRYCK FÖR ATT<br />VÄLJA KRAFT!
      </p>

      <!-- The Wheel -->
      <div style="position: relative; width: 300px; height: 300px">
        <div
          style="
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #fff;
            z-index: 10;
          "
        ></div>
        <canvas id="wheel-canvas" width="300" height="300"></canvas>
      </div>

      <!-- Power Meter -->
      <div id="power-meter-container">
        <div id="power-bar"></div>
      </div>

      <button
        id="power-btn"
        class="action-btn"
        style="margin-top: 20px; width: 200px; font-size: 16px"
      >
        STOPP
      </button>
    </div>

    <!-- Solve Modal -->
    <div
      id="solve-modal"
      class="fixed inset-0 z-50 bg-black bg-opacity-90 hidden flex items-center justify-center"
    >
      <div class="border-4 border-white bg-blue-900 p-5 text-center">
        <h2 class="text-yellow-400 mb-4">LÖS PUSSLET</h2>
        <input
          type="text"
          id="solve-input"
          class="p-2 text-black uppercase w-full mb-4 font-bold"
          autofocus
        />
        <div>
          <button
            class="action-btn bg-red-500"
            onclick="document.getElementById('solve-modal').classList.add('hidden')"
          >
            AVBRYT
          </button>
          <button class="action-btn bg-green-500" onclick="confirmSolve()">
            OK
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- GAME DATA (TRANSLATED) ---
      const PUZZLES = [
        { text: "SUPER MARIO BROS", category: "SPELTITEL" },
        { text: "NINTENDO ENTERTAINMENT", category: "KONSOL" },
        { text: "LEGEND OF ZELDA", category: "SPELTITEL" },
        { text: "DET ÄR EN HEMLIGHET", category: "FRAS" },
        { text: "TACK MARIO", category: "FRAS" },
        { text: "DONKEY KONG", category: "KARAKTÄR" },
        { text: "SVAMPRIKET", category: "PLATS" },
        { text: "BÄTTRE SENT ÄN ALDRIG", category: "ORDSPRÅK" },
        { text: "INGEN KO PÅ ISEN", category: "ORDSPRÅK" },
      ];

      const WHEEL_SEGMENTS = [
        { val: 500, color: "#F00" },
        { val: 200, color: "#FFF", textCol: "#000" },
        { val: 0, text: "STÅ ÖVER", color: "#FF0", textCol: "#000" },
        { val: 750, color: "#00F" },
        { val: 300, color: "#0F0" },
        { val: 0, text: "BANKRUTT", color: "#000", textCol: "#FFF" },
        { val: 400, color: "#F0F" },
        { val: 600, color: "#F00" },
        { val: 250, color: "#FFF", textCol: "#000" },
        { val: 900, color: "#00F" },
        { val: 1000, color: "#FFD700", textCol: "#000" },
        { val: 150, color: "#0F0" },
      ];

      const VOWELS = ["A", "E", "I", "O", "U", "Y", "Å", "Ä", "Ö"];
      const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZÅÄÖ".split("");

      // --- STATE ---
      let state = {
        puzzle: null,
        guessed: [],
        score: 0,
        spinVal: 0,
        phase: "START", // START, GAME, SPIN_POWER, SPINNING, SOLVE
        power: 0,
        powerDir: 1,
        wheelAngle: 0,
      };

      // --- DOM ---
      const startScreen = document.getElementById("start-screen");
      const gameScreen = document.getElementById("game-screen");
      const wheelOverlay = document.getElementById("wheel-overlay");
      const boardContainer = document.getElementById("board-container");
      const keybContainer = document.getElementById("keyboard");
      const msgEl = document.getElementById("game-msg");
      const powerBar = document.getElementById("power-bar");
      const powerBtn = document.getElementById("power-btn");
      const scoreDisplay = document.getElementById("score-display");
      const catDisplay = document.getElementById("category-display");

      // --- AUDIO (Simple Synth) ---
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      function playTone(freq, type, dur) {
        if (audioCtx.state === "suspended") audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + dur);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + dur);
      }

      // --- INIT ---
      function startGame() {
        playTone(440, "square", 0.5); // Start sound
        startScreen.classList.remove("active");
        gameScreen.classList.add("active");
        loadPuzzle();
        createKeyboard();
        drawWheelStatic();
        updateUI();
      }

      function loadPuzzle() {
        state.puzzle = PUZZLES[Math.floor(Math.random() * PUZZLES.length)];
        state.guessed = [];
        state.score = 0;
        state.phase = "GAME";

        // Build Board
        boardContainer.innerHTML = "";
        // 4 rows, 14 cols grid
        for (let r = 0; r < 4; r++) {
          const row = document.createElement("div");
          row.className = "board-row";
          let rowHtml = "";
          for (let c = 0; c < 14; c++) {
            rowHtml += `<div class="board-cell" id="c-${r}-${c}"><span class="letter-content"></span></div>`;
          }
          row.innerHTML = rowHtml;
          boardContainer.appendChild(row);
        }

        // Place Text with Safer Logic
        const words = state.puzzle.text.split(" ");
        let currentLine = "";
        let lines = [];

        words.forEach((w) => {
          // Check if adding the word AND a space (if not first word) fits
          let testLine = currentLine.length > 0 ? currentLine + " " + w : w;

          if (testLine.length <= 14) {
            currentLine = testLine;
          } else {
            lines.push(currentLine);
            currentLine = w;
          }
        });
        if (currentLine) lines.push(currentLine);

        const startRow = Math.floor((4 - lines.length) / 2);
        lines.forEach((line, i) => {
          const r = startRow + i;
          const startCol = Math.floor((14 - line.length) / 2);
          for (let j = 0; j < line.length; j++) {
            const char = line[j];
            if (char !== " ") {
              const cell = document.getElementById(`c-${r}-${startCol + j}`);
              if (cell) {
                // Safety check to prevent crash
                cell.classList.add("active");
                cell.dataset.char = char;
              }
            }
          }
        });

        catDisplay.innerText = state.puzzle.category;
        updateUI();
      }

      // --- SPIN SEQUENCE ---
      let powerInterval;
      let spinAnim;

      function startSpinSequence() {
        if (state.phase !== "GAME") return;
        state.phase = "SPIN_POWER";
        wheelOverlay.classList.add("active");
        document.getElementById("power-meter-container").style.display =
          "block";
        document.getElementById("spin-status-text").innerText =
          "TRYCK FÖR ATT\nVÄLJA KRAFT!";
        powerBtn.innerText = "STOPPA KRAFT";

        // Start Power Bar Animation
        state.power = 0;
        state.powerDir = 2; // Speed
        powerInterval = setInterval(() => {
          state.power += state.powerDir;
          if (state.power >= 100 || state.power <= 0) state.powerDir *= -1;
          powerBar.style.width = state.power + "%";
        }, 16);

        powerBtn.onclick = lockPower;
      }

      function lockPower() {
        clearInterval(powerInterval);
        playTone(200, "sawtooth", 0.2);
        state.phase = "SPINNING";
        powerBtn.style.display = "none"; // Hide button during spin
        document.getElementById("spin-status-text").innerText = "SNURRAR...";

        // Spin Logic
        let speed = (state.power / 100) * 0.8 + 0.2; // Min 0.2, Max 1.0
        animateWheel(speed);
      }

      function animateWheel(speed) {
        state.wheelAngle += speed;
        speed *= 0.985; // Friction
        drawWheelStatic();

        if (speed > 0.002) {
          spinAnim = requestAnimationFrame(() => animateWheel(speed));
          // Click sound
          if (Math.floor(state.wheelAngle * 10) % 5 === 0)
            playTone(100, "square", 0.05);
        } else {
          finishSpin();
        }
      }

      function finishSpin() {
        cancelAnimationFrame(spinAnim);

        // Calculate Result
        const segAngle = (2 * Math.PI) / WHEEL_SEGMENTS.length;
        const normAngle = state.wheelAngle % (2 * Math.PI);
        // Pointer is at Top (3PI/2 or 270deg).
        // Angle increases clockwise.
        // Logic: Index = (TotalAngle + Offset) converted to index
        // Simplified: The segment AT the pointer.
        // Pointer is at -90deg (top).
        let effectiveAngle = (3 * Math.PI) / 2 - normAngle;
        if (effectiveAngle < 0) effectiveAngle += 2 * Math.PI;
        const idx = Math.floor(effectiveAngle / segAngle);
        const res = WHEEL_SEGMENTS[idx];

        state.spinVal = res.val;

        // Show result briefly
        document.getElementById("spin-status-text").innerText = res.text
          ? res.text
          : "$" + res.val;

        setTimeout(() => {
          wheelOverlay.classList.remove("active");
          powerBtn.style.display = "block"; // Reset for next time
          handleSpinResult(res);
        }, 1500);
      }

      function drawWheelStatic() {
        const cvs = document.getElementById("wheel-canvas");
        const ctx = cvs.getContext("2d");
        const cx = 150,
          cy = 150,
          r = 145;
        const segSize = (2 * Math.PI) / WHEEL_SEGMENTS.length;

        ctx.clearRect(0, 0, 300, 300);

        WHEEL_SEGMENTS.forEach((seg, i) => {
          const a1 = state.wheelAngle + i * segSize;
          const a2 = a1 + segSize;
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.arc(cx, cy, r, a1, a2);
          ctx.fillStyle = seg.color;
          ctx.fill();
          ctx.stroke();

          // Text
          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate(a1 + segSize / 2);
          ctx.textAlign = "right";
          ctx.fillStyle = seg.textCol || "#fff";
          ctx.font = "bold 16px monospace";
          ctx.fillText(
            seg.text ? (seg.text.includes("BANK") ? "BANK" : "ÖVER") : seg.val,
            r - 10,
            5
          );
          ctx.restore();
        });

        // Center
        ctx.beginPath();
        ctx.arc(cx, cy, 20, 0, 2 * Math.PI);
        ctx.fillStyle = "#DAA520";
        ctx.fill();
      }

      // --- GAME LOGIC ---
      function handleSpinResult(res) {
        if (res.text === "BANKRUTT") {
          playTone(100, "sawtooth", 0.5); // Sad noise
          state.score = 0;
          msgEl.innerText = "BANKRUTT! SNURRA IGEN.";
          state.phase = "GAME";
        } else if (res.text === "STÅ ÖVER") {
          playTone(150, "sawtooth", 0.3);
          msgEl.innerText = "STÅR ÖVER! SNURRA IGEN.";
          state.phase = "GAME";
        } else {
          msgEl.innerText = `$${res.val} - VÄLJ EN KONSONANT`;
          state.phase = "GUESS_CONSONANT";
          highlightKeys("CONSONANT");
        }
        updateUI();
      }

      function handleKey(char) {
        if (state.phase === "GUESS_CONSONANT") {
          if (VOWELS.includes(char)) return; // Only consonants
          processGuess(char);
        } else if (state.phase === "BUY_VOWEL") {
          if (!VOWELS.includes(char)) return; // Only vowels
          state.score -= 250;
          processGuess(char);
        }
      }

      function processGuess(char) {
        // Disable key
        state.guessed.push(char);
        updateUI(); // Refreshes keyboard

        // Check board
        let count = 0;
        document.querySelectorAll(".board-cell.active").forEach((cell) => {
          if (cell.dataset.char === char) {
            count++;
            const span = cell.querySelector(".letter-content");
            span.innerText = char;
            span.classList.add("visible");
            // "Ding" per letter
            setTimeout(
              () => playTone(600 + count * 50, "sine", 0.1),
              count * 200
            );
          }
        });

        if (count > 0) {
          if (state.phase !== "BUY_VOWEL") state.score += state.spinVal * count;
          msgEl.innerText = `HITTADE ${count} ${char}! SNURRA, KÖP ELLER LÖS.`;
          state.phase = "GAME";

          // Check win
          const left = document.querySelectorAll(
            ".board-cell.active .letter-content:not(.visible)"
          ).length;
          if (left === 0) doWin();
        } else {
          playTone(100, "sawtooth", 0.4); // Buzz
          msgEl.innerText = `INGA ${char}. NÄSTA SPELARE.`;
          state.phase = "GAME";
        }
        updateUI();
      }

      function createKeyboard() {
        keybContainer.innerHTML = "";
        ALPHABET.forEach((char) => {
          const b = document.createElement("button");
          b.className = `key ${VOWELS.includes(char) ? "vowel" : ""}`;
          b.innerText = char;
          b.onclick = () => handleKey(char);
          keybContainer.appendChild(b);
        });
      }

      function updateUI() {
        scoreDisplay.innerText = state.score.toString().padStart(4, "0");

        // Buttons
        document.getElementById("btn-spin").disabled = state.phase !== "GAME";
        document.getElementById("btn-solve").disabled = state.phase !== "GAME";
        document.getElementById("btn-buy").disabled =
          state.phase !== "GAME" || state.score < 250;

        // Keys
        const keys = keybContainer.querySelectorAll(".key");
        keys.forEach((k) => {
          const char = k.innerText;
          if (state.guessed.includes(char)) {
            k.disabled = true;
            k.style.opacity = 0.2;
          } else {
            k.disabled = true; // Default disabled
            k.style.opacity = 1;

            if (state.phase === "GUESS_CONSONANT" && !VOWELS.includes(char))
              k.disabled = false;
            if (state.phase === "BUY_VOWEL" && VOWELS.includes(char))
              k.disabled = false;
          }
        });
      }

      function highlightKeys(type) {
        updateUI(); // Logic is inside updateUI
      }

      function buyVowelMode() {
        state.phase = "BUY_VOWEL";
        msgEl.innerText = "VÄLJ EN VOKAL";
        updateUI();
      }

      function solveMode() {
        document.getElementById("solve-modal").classList.remove("hidden");
        document.getElementById("solve-input").focus();
      }

      function confirmSolve() {
        const guess = document
          .getElementById("solve-input")
          .value.toUpperCase();
        document.getElementById("solve-modal").classList.add("hidden");
        document.getElementById("solve-input").value = "";

        if (guess === state.puzzle.text) {
          // Reveal all
          document
            .querySelectorAll(".board-cell.active .letter-content")
            .forEach((s) => {
              s.innerText = s.parentElement.dataset.char;
              s.classList.add("visible");
            });
          doWin();
        } else {
          playTone(100, "sawtooth", 0.4);
          msgEl.innerText = "FEL SVAR!";
        }
      }

      function doWin() {
        playTone(500, "square", 0.1);
        setTimeout(() => playTone(600, "square", 0.1), 150);
        setTimeout(() => playTone(700, "square", 0.4), 300);
        msgEl.innerText = "PUSSLET LÖST! DU VANN!";
        msgEl.classList.add("blink");
        setTimeout(() => {
          if (confirm("DU VANN! Spela igen?")) startGame();
        }, 2000);
      }

      window.onload = () => {
        // Init with Start Screen Active
        drawWheelStatic();
      };
    </script>
  </body>
</html>
